<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/studentDetail.css">
</head>
<body>
    <h3 class="pageTitle"></h3>

    <div class="personalBaseMessage" state="spread">
        <div class="editBtn"><img src="img/edit.png"/></div>
        <p class="title">
            个人基本信息
        </p>
        <p>
            <span>姓名：</span>
            <span class="stuName">xxx</span>
        </p>
        <p>
            <span>性别：</span>
            <span class="stuSex">xx男x</span>
        </p>
        <p>
            <span>出生年月：</span>
            <span class="stuBirthday">2002/09/10</span>
        </p>
        <p>
            <span>层次：</span>
            <span class="stuEducationallevel">2002/09/10</span>
        </p>
        <p>
            <span>政治面貌：</span>
            <span class="stuPoliticalstatus">2002/09/10</span>
        </p>
        <p>
            <span>身份证号：</span>
            <span class="stuIdNumber">2002/09/10</span>
        </p>
        <p>
            <span>电话号码：</span>
            <span class="phone">13200988767</span>
        </p>
        <p>
            <span>家庭地址：</span>
            <span class="homeAddress">四川省 泸州市 合江县 五通镇</span>
        </p>
        <p>
            <span>QQ号：</span>
            <span class="QQ">2650320028</span>
        </p>
        <p>
            <span>微信号：</span>
            <span class="wechat">WX129087656</span>
        </p>
        <p>
            <span>是否抽烟：</span>
            <span class="isSmoke">否</span>
        </p>
        <p>
            <span>烟龄：</span>
            <span class="smokeAge">0</span>
        </p>
        <p>
            <span>原因:</span>
            <span class="whySmoke">不想抽烟</span>
        </p>
        <p>
            <span>是否恋爱：</span>
            <span class="isLove">否</span>
        </p>
        <p>
            <span>原因：</span>
            <span class="whyLove">没人爱</span>
        </p>
        <p>
            <span>对象：</span>
            <span class="lover">木有</span>
        </p>
        <p>
            <span>暴力倾向：</span>
            <span class="isViolence">否</span>
        </p>
        <p>
            <span>原因：</span>
            <span class="whyViolence">没有就没有</span>
        </p>
        <p>
            <span>既往病史：</span>
            <span class="medicalhistory">无（初中 鼻炎手术）</span>
        </p>
        <p>
            <span>生活开销：</span>
            <span class="lifeexpenses">200-300</span>
        </p>
        <p>
            <span>家庭收入：</span>
            <span class="homeincome"></span>
        </p>
        <p>
            <span>兴趣爱好：</span>
            <span class="hobby">打游戏</span>
        </p>
        <p>
            <span>活动参与情况与在校表现：</span>
            <span class="performance">无表现</span>
        </p>
        <p>
            <span>备注：</span>
            <span class="remark"></span>
        </p>
    </div>

    <div class="pullPushPersonalBaseMessageBtn">
        <img src="img/pushPBM.png" width="30px" height="30px" /></div>
    <div class="editPersonalBaseMessage"></div>

    <div class="sanction" state="shrink">
        <p class="title">学生奖罚记录<span class="add">添加</span></p>
        <table>
            <thead>
                <tr>
                    <td>时间</td><td>奖罚级别</td><td>名称</td><td>等级</td><td>其他</td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="sanctionEditMask">
        <div class="sanctionEdit">
            <input type="hidden" name="id" />
            <p>时间: <input name="time" type="date" /></p>
            <p>奖罚级别: <input name="rank" type="text" /></p>
            <p>名称: <input name="name" type="text" /></p>
            <p>等级: <input name="level" type="text" /></p>
            <p>其他: <input name="other" type="text" /></p>
            <button class="confirm">确 定</button>
        </div>
        <p class="close"><img src="img/close_btn.png" width="100%" height="100%"></p>
    </div>


    <div class="personalPlan">
        <p class="title">个人规划<span class="add">添加</span></p>
        <table>
            <thead>
                <tr>
                    <td>目标</td><td>完成时间</td><td>备注</td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="personalPlanEditMask">
        <div class="personalPlanEdit">
            <input type="hidden" name="id" />
            <p>目标: <input name="goal" type="text" /></p>
            <p>完成时间: <input name="finishTime" type="date" /></p>
            <p>备注: <input name="remark" type="text" /></p>
            <button class="confirm">确 定</button>
        </div>
        <p class="close"><img src="img/close_btn.png" width="100%" height="100%"></p>
    </div>


    <div class="familyMember">
        <p class="title">家庭主要成员<span class="add">添加</span></p>
        <table>
            <thead>
                <tr>
                  <td>关系</td><td>姓名</td><td>工作单位</td><td>联系电话</td><td>备注</td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="familyMemberEditMask">
        <div class="familyMemberEdit">
            <input type="hidden" name="id" />
            <p>关系: <input name="relationship" type="text" /></p>
            <p>姓名: <input name="name" type="text" /></p>
            <p>工作单位: <input name="workunit" type="text" /></p>
            <p>联系电话: <input name="phone" type="text" /></p>
            <p>备注: <input name="remark" type="text" /></p>
            <button class="confirm">确 定</button>
        </div>
        <p class="close"><img src="img/close_btn.png" width="100%" height="100%"></p>
    </div>

    <script type="application/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script type="application/javascript" src="js/common.js"></script>
    <script type="application/javascript" src="js/stuDetail_personalMessage.js"></script>
    <script type="application/javascript" src="js/stuDetail_sanction.js"></script>
    <script type="application/javascript" src="js/stuDetail_personalPlan.js"></script>
    <script>
        /*
        * 获取个人规划
        * */
        var getFamilyMembersByStuId = function(){
            httpGet('/student/families?stuId='+getRequestParam()['stuid']).then(function(familyMembers){
                console.log(familyMembers)
                if (familyMembers.length > 0){
                    var tr = ''
                    for (var f in familyMembers){
                        var fa = familyMembers[f];
                        tr += '<tr faid="'+fa.id+'"farelationship="'+
                            fa.relationship+'" faname="'+
                            fa.name+'" faworkunit="'+
                            fa.workunit+'" faphone="'+
                            fa.phone+'" faremark="'+
                            fa.remark+'">' +
                                '<td>'+fa.relationship+'</td>'+
                                '<td>'+fa.name+'</td>'+
                                '<td>'+fa.workunit+'</td>'+
                                '<td>'+fa.phone+'</td>'+
                                '<td>'+fa.remark+'</td>'+
                            '</tr>'
                    }
                    $('.familyMember tbody').html(tr);
                    $('.familyMember table tbody tr').click(function () {
                        var id = $(this).attr('faid')
                        var farelationship = $(this).attr('farelationship')
                        var faname = $(this).attr('faname')
                        var faworkunit = $(this).attr('faworkunit')
                        var faphone = $(this).attr('faphone')
                        var faremark = $(this).attr('faremark')
                        setFamilyMemberEditValue(new FamilyMember(id,farelationship,faname,faworkunit,faphone,faremark,getRequestParam()['stuid']))
                        familyMemberEditMaskDisplay(true);
                    })
                }
            }).catch(function(err){
                dealHttpErr(err)
            })
        }
        getFamilyMembersByStuId()

        //个人规划添加按钮
        $('.familyMember .add').click(function(){
            familyMemberEditMaskDisplay(true)
        })
        /*
        *关闭个人规划弹窗
        * */
        $('.familyMemberEditMask .close').click(function(){
            familyMemberEditMaskDisplay(false)
        })
        $('.familyMemberEditMask .confirm').click(function(){
            familyMemberEditMaskConfirm()
        })
        var familyMemberEditMaskDisplay = function(isOpen){
            if (isOpen) {
                $('.familyMemberEditMask').css('display','block')
            }else {
                $('.familyMemberEditMask').css('display','none')
                cleanFamilyMemberEditValue()
            }
        }
        var cleanFamilyMemberEditValue = function(){
            $('.familyMemberEdit input[name="id"]').val('')
            $('.familyMemberEdit input[name="relationship"]').val('')
            $('.familyMemberEdit input[name="name"]').val('')
            $('.familyMemberEdit input[name="workunit"]').val('')
            $('.familyMemberEdit input[name="phone"]').val('')
            $('.familyMemberEdit input[name="remark"]').val('')
        }
        var setFamilyMemberEditValue = function(fa){
            $('.familyMemberEdit input[name="id"]').val(fa.id)
            $('.familyMemberEdit input[name="relationship"]').val(fa.relationship)
            $('.familyMemberEdit input[name="name"]').val(fa.name)
            $('.familyMemberEdit input[name="workunit"]').val(fa.workunit)
            $('.familyMemberEdit input[name="phone"]').val(fa.phone)
            $('.familyMemberEdit input[name="remark"]').val(fa.remark)
        }
        var familyMemberEditMaskConfirm = function(){
            var id = $('.familyMemberEdit input[name="id"]').val()
            var relationship = $('.familyMemberEdit input[name="relationship"]').val()
            if (!relationship) {alert('请填写关系');return;}
            var name = $('.familyMemberEdit input[name="name"]').val()
            if (!name) {alert('请填写姓名');return}
            var workunit = $('.familyMemberEdit input[name="workunit"]').val()
            var phone = $('.familyMemberEdit input[name="phone"]').val()
            var remark = $('.familyMemberEdit input[name="remark"]').val()
            postFamilyMember(new FamilyMember(id,relationship,name,workunit,phone,remark,getRequestParam()['stuid']))
        }
        var postFamilyMember = function(familyMember){
            httpPost('/student/families',familyMember).then(function(fa){
                if (familyMember.id==fa.id){
                    alert('修改成功')
                }else {
                    alert('增加成功')
                }
                getFamilyMembersByStuId()
                familyMemberEditMaskDisplay(false)
            }).catch(function(err){
                dealHttpErr(err)
            })
        }

    </script>
</body>
</html>